<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Bubblescope - Your Contact List</title>
    <link rel="icon" href="images/45.png"></link>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.5.6/angular.min.js"></script>
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/1.3.3/ui-bootstrap.min.js"></script>
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/1.3.3/ui-bootstrap-tpls.min.js"></script>

    <script>
      angular.module('mainApp', ['ui.bootstrap']);

      angular.module('mainApp').controller('mainCtrl', function($scope,$http,$uibModal){

        var promise = $http.get('/listReturn');
        promise.then(httpSuccess, httpError);
        function httpSuccess(response) {$scope.entryList = response.data;}
        function httpError(response) {console.log('http error : ', response);}

        function getList() {
          $http.get('/listReturn').then(function(response){
            $scope.entryList = response.data;
          });
        }



        $scope.disappear = function(){
          $scope.jumboHide = true;
        }

        $scope.setSortValues = function (value){
          if($scope.sortValue===value){
            $scope.sortReverse = !$scope.sortReverse;
            return;
          }
          $scope.sortValue = value;
          $scope.sortReverse = false;
        };

        $scope.sortIcon = function(prop) {              // Checks to see if prop is the current sort prop and returns a glyph for that sort direction
          if($scope.sortValue!==prop) return null;     // If sortProp isn't prop, return null
          if($scope.sortReverse===false) return 'glyphicon glyphicon-triangle-bottom';     // If not reversed, show down arrow
          if($scope.sortReverse===true)  return 'glyphicon glyphicon-triangle-top';       // If reversed, show up arrow
        };




        $scope.addContact = function(bubbleBack) {   //this is called when Add Contact clicked, and opens a modal window

          var modalInstance = $uibModal.open({
            templateUrl: 'addcontact.html',   //loads html template
            controller: 'addcontactCtrl',   //loads modal controller for this instance
            resolve: {
              bubblePass: function() {return bubbleBack;}		//brings a passed post along for the ride
            }
          });
          modalInstance.result.then(function() {			//then refresh the list after modal closes
            getList();
          });

        }  //end addContact()

        $scope.viewContact = function(bubbleBack) {   //this is called when image is clicked, and opens a modal window

          var modalInstance = $uibModal.open({
            templateUrl: 'contactview.html',   //loads html template
            controller: 'contactviewCtrl',   //loads modal controller for this instance
            resolve: {
              bubblePass: function() {return bubbleBack;}		//brings a passed post along for the ride
            }
          });
          modalInstance.result.then(function() {			//then refresh the list after modal closes
            getList();
          });

        } // end viewContact()

      }); // End bubbleCtrl

      angular.module('mainApp').controller('addcontactCtrl', function($scope,$uibModal,$uibModalInstance,$http,bubblePass) {		// Inject our dependencies and postPass

        $scope.newEntry = angular.copy(bubblePass); //populates the form with the data in the postBack that we passed as postPass here

        $scope.saveEntry = function() {  //What happens when saveButton is clicked

          var picNumber= Math.floor((Math.random() * 12) + 1);
          $scope.newEntry.image = "images/"+picNumber+".png"; //assigns a ramdom pic from the 12 options

          $http.post('/listReturn',$scope.newEntry).then(function(response){  // Pushes the post to the server, where it will be added or updated accordingly
            $uibModalInstance.close();
          });

        }

        $scope.cancel = function() {  // What happens when the Cancel button is clicked
          $uibModalInstance.dismiss();   // drops out of the modal via Cancel button
        }
      }); //End addcontactCtrl




      // contactviewCtrl
      angular.module('mainApp').controller('contactviewCtrl', function($scope,$uibModal,$uibModalInstance,$http,bubblePass) {		// Inject our dependencies and postPass

        $scope.thisEntry = angular.copy(bubblePass); //populates the form with the data in the postBack that we passed as postPass here

        // function getOne(findMe) {
        //   $http.get('listReturn/byId/'+findMe._id).then(function(response){
        //     $scope.thisEntry = angular.copy(response.data);
        //   });
        // }

        $scope.closeMe = function(){
          $uibModalInstance.close();
        }

        // $scope.thisEntry = getOne(bubblePass);

        $scope.updateContact = function(bubbleBack) {   //this is called when Edit is clicked, and opens a modal window

          // $uibModalInstance.dismiss().then(function(){ //close current modal???

            var modalInstance = $uibModal.open({
              templateUrl: 'updatecontact.html',   //loads html template
              controller: 'updatecontactCtrl',   //loads modal controller for this instance
              resolve: {
                bubblePass: function() {return bubbleBack;}		//brings a passed post along for the ride
              }
            });
            modalInstance.result.then(function(response){  // Pushes the post to the server, where it will be added or updated accordingly
              $uibModalInstance.close();
            });
          // });

        }
      }); //End contactviewCtrl

      angular.module('mainApp').controller('updatecontactCtrl', function($scope,$uibModal,$uibModalInstance,$http,bubblePass) {		// Inject our dependencies and postPass

        // function getOne(findMe) {
        //   $http.get('listReturn/byId/'+findMe._id).then(function(response){
        //     return response.data;
        //   });
        // }
        // $scope.thisEntry = angular.copy(bubblePass); //populates the form with the data in the postBack that we passed as postPass here
        $scope.thisEntry = angular.copy(bubblePass);

        $scope.saveEntry = function() {  //What happens when saveButton is clicked

          $http.post('/listReturn',$scope.thisEntry).then(function(response){  // Pushes the post to the server, where it will be added or updated accordingly
            $uibModalInstance.close();
          });
        }

        $scope.killEntry = function() {  // What happens when the Delete button is clicked
          $http.delete('/listReturn/'+$scope.thisEntry._id).then(function(){    // deletes the selected from the database
            $uibModalInstance.close();
          });
        }

        $scope.cancel = function() {  // What happens when the Cancel button is clicked
          $uibModalInstance.dismiss();   // drops out of the modal via Cancel button
        }

      }); //End updatecontactCtrl


    </script>



  </head>

  <body ng-app="mainApp" ng-controller="mainCtrl">


    <div class="jumbotron" style="padding-top: 120px; background-color: #999" ng-if="!jumboHide" ng-click="disappear()">
      <div class="container text-center">
        <img src="images/45.png" class="img-circle" style="background-color: white">
        <h1><span style="color:#00b8ff">Bubble</span><span style="color:white">scope</span></h1>
        <p style="color:white">Welcome to your personal bubble</p>
      </div>
    </div>


    <nav class="navbar navbar-default navbar-fixed-top" style="background-color:#00b8ff; height: 65px;">

      <div class="container" style="padding:0; margin:0 auto">
        <!-- <div class="row"> -->

        <div class="pull-left" style="background-color:#00b8ff; min-width: 100px; border: solid 13px #00b8ff; ">
          <span class="label" style=" font-size: 1.5em; font-weight: 400; line-height: 30px; ">Add a bubble...</span>
            <span class="glyphicon glyphicon-plus-sign pull-right" ng-click="addContact()" style="font-size:2.5em; color:white;  line-height: 30px;"></span>
        </div>

          <div class="text-center" style="background-color:#00b8ff; min-width: 430px">
            <form class="navbar-form navbar-left" role="search" style="background-color:#00b8ff;">
              <div class="form-group" style="margin-top: 6px">
                <span class="label pull-left" style="background-color:#00b8ff; font-size: 1.5em; font-weight: 400; line-height: 25px;">Search your bubbles... </span>
                <input type="text" class="form-control col-xs-4 pull-right" ng-model="searchValue.$">
              </div>
            </form>
          </div>

          <div class="pull-right" style="background-color:#00b8ff; min-width: 450px ">
            <div class="pull-left form-group" style="margin-top: 15px">
              <span class="label" style="background-color:#00b8ff; font-size: 1.5em; font-weight: 400; line-height: 30px">Sort your bubbles... </span>
            </div>
            <div class="btn-group pull-right" role="group" style=" margin-top: 6px; font-size: 1.3em">
              <button type="button" class="btn btn-info btn-lg" ng-click="setSortValues('firstName')" style="border: solid 3px white; background-color:#00b8ff; font-weight: 500">First Name <span ng-class="sortIcon('firstName')"></span></button>
              <button type="button" class="btn btn-info btn-lg" ng-click="setSortValues('lastName')" style="border: solid 3px white; background-color:#00b8ff; font-weight: 500">Last Name <span ng-class="sortIcon('lastName')"></span></button>
              <!-- <button type="button" class="btn btn-default">Email</button> -->
            </div>
          </div>
        <!-- </div> -->
      </div>
    </nav>

    <div class="container" style="margin-top: 150px">
      <div class="row">
        <div class="col-xs-12 col-sm-6 col-md-3"  ng-repeat="entry in entryList | filter:searchValue | orderBy:sortValue:sortReverse">
          <div class="text-center" ng-click="viewContact(entry)" style="margin: 20px 0">
            <img ng-src="{{entry.image}}" class="img-circle" style="width:140px">
            <h3>{{entry.firstName}}</h3>
            <p>{{entry.lastName}}</p>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
